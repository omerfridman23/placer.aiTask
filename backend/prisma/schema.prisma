generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Chain {
  chainId   String   @id @map("chain_id")
  chainName String   @unique @map("chain_name")
  entities  Entity[] @relation("EntityChain")
  stores    Store[]

  @@index([chainName])
  @@map("chains")
}

model Store {
  chainId       String    @map("chain_id")
  storeId       String    @map("store_id")
  name          String
  geolocation   String?
  country       String
  stateCode     String    @map("state_code")
  stateName     String    @map("state_name")
  city          String
  postalCode    String?   @map("postal_code")
  formattedCity String?   @map("formatted_city")
  streetAddress String?   @map("street_address")
  subCategory   String?   @map("sub_category")
  dma           String?   @map("dma")
  cbsa          String?   @map("cbsa")
  areaSqft      Int?      @map("area_sqft")
  dateOpened    DateTime? @map("date_opened")
  dateClosed    DateTime? @map("date_closed")
  entities      Entity[]  @relation("EntityStore")
  chain         Chain     @relation(fields: [chainId], references: [chainId])

  @@id([chainId, storeId])
  @@index([subCategory])
  @@index([dma])
  @@index([stateCode, city])
  @@index([dateClosed])
  @@map("stores")
}

model Entity {
  entityId        String   @id @map("entity_id")
  entityType      String   @map("entity_type")
  footTraffic     Int      @map("foot_traffic")
  sales           Decimal? @db.Decimal(18, 2)
  avgDwellTimeMin Int?     @map("avg_dwell_time_min")
  ftPerSqft       Decimal? @map("ft_per_sqft") @db.Decimal(18, 4)
  chainId         String   @map("chain_id")
  storeId         String   @map("store_id")
  chain           Chain    @relation("EntityChain", fields: [chainId], references: [chainId])
  store           Store    @relation("EntityStore", fields: [chainId, storeId], references: [chainId, storeId])

  @@index([chainId])
  @@map("entities")
}
